\section{CALICE::ConditionsDataWriteHandler Class Reference}
\label{classCALICE_1_1ConditionsDataWriteHandler}\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}


Handler of conditions data changes which writes the replaced collections to a conditions data base.  


{\ttfamily \#include $<$ConditionsDataWriteHandler.hh$>$}\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
{\bf ConditionsDataWriteHandler} (const std::string \&col\_\-name, const std::string \&db\_\-init\_\-string, const std::string \&folder\_\-name, const std::string \&tag, const std::string \&description)
\begin{DoxyCompactList}\small\item\em constructor. \item\end{DoxyCompactList}\item 
{\bf $\sim$ConditionsDataWriteHandler} ()\label{classCALICE_1_1ConditionsDataWriteHandler_a581dea40c8faa28948c8cb461d9126dc}

\begin{DoxyCompactList}\small\item\em destructor. \item\end{DoxyCompactList}\item 
void {\bf conditionsChanged} (lcio::LCCollection $\ast$col)
\begin{DoxyCompactList}\small\item\em Be notified if conditions data changes and redirect changes to responsible class. \item\end{DoxyCompactList}\item 
void {\bf writeConditionsData} (const long64 \&best\_\-guess\_\-of\_\-till\_\-time\_\-stamp)
\begin{DoxyCompactList}\small\item\em write the conditions data to the conditions database. \item\end{DoxyCompactList}\item 
void {\bf setSinceTime} (long64 since\_\-time)
\begin{DoxyCompactList}\small\item\em Set the correct since time for the current conditions data. \item\end{DoxyCompactList}\item 
const std::string \& {\bfseries name} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a578e53e8c53ee791d1ab574811551496}

\item 
unsigned int {\bf numberOfWrites} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a535ca783c3475b0cbacd99484c4e4229}

\begin{DoxyCompactList}\small\item\em Get the number of collections written to the database;. \item\end{DoxyCompactList}\item 
unsigned int {\bf changes} () const \label{classCALICE_1_1ConditionsDataWriteHandler_ae53d14eec368dc28b8bc5dcb73ed2d01}

\begin{DoxyCompactList}\small\item\em Get the number of recognised changes of the conditions data. \item\end{DoxyCompactList}\item 
long64 {\bf validAtMostSince} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a1899ab4669280acec16c6baa53e6abc3}

\begin{DoxyCompactList}\small\item\em Get the time of the first recognised conditions data change. \item\end{DoxyCompactList}\item 
long64 {\bf validAtMostTill} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a487fe71c6d796b46dac6dd7ea16eb917}

\begin{DoxyCompactList}\small\item\em Get the time of the last write to the data base. \item\end{DoxyCompactList}\item 
long64 {\bf currentValidSince} () const \label{classCALICE_1_1ConditionsDataWriteHandler_ac3a420cb581ed9519e06e795dd13ac9a}

\begin{DoxyCompactList}\small\item\em Get the time of the first recognised conditions data change. \item\end{DoxyCompactList}\item 
long64 {\bf currentValidTill} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a7cae6dc5fd78a5aa243bb589ba4c7caa}

\begin{DoxyCompactList}\small\item\em Get the time of the last write to the data base. \item\end{DoxyCompactList}\item 
const std::string \& {\bfseries getTag} () const \label{classCALICE_1_1ConditionsDataWriteHandler_a3e14961a4bf03b6282f2b59fe87790fa}

\end{DoxyCompactItemize}
\subsection*{Private Attributes}
\begin{DoxyCompactItemize}
\item 
const std::string {\bf \_\-colName}\label{classCALICE_1_1ConditionsDataWriteHandler_a7e065bb6ab09b579ce20f7dbbbdf07a2}

\begin{DoxyCompactList}\small\item\em name of the collection (not used) \item\end{DoxyCompactList}\item 
lccd::DBInterface {\bfseries \_\-db}\label{classCALICE_1_1ConditionsDataWriteHandler_a94ae745611b1bff4441eab7677c408c1}

\item 
lccd::IConditionsHandler $\ast$ {\bf \_\-changeHandler}\label{classCALICE_1_1ConditionsDataWriteHandler_a3a20bce4a053386c2d4f786653438f38}

\begin{DoxyCompactList}\small\item\em handler of the conditions data \item\end{DoxyCompactList}\item 
const std::string {\bfseries \_\-tag}\label{classCALICE_1_1ConditionsDataWriteHandler_a62de4dca742011f4fdb976d4bb3abee2}

\item 
const std::string {\bfseries \_\-description}\label{classCALICE_1_1ConditionsDataWriteHandler_a01342556e5b2c4916dbb3d3705dd0af3}

\item 
long64 {\bf \_\-since}
\begin{DoxyCompactList}\small\item\em the time of the event just before the conditions data changed. \item\end{DoxyCompactList}\item 
long64 {\bf \_\-till}
\begin{DoxyCompactList}\small\item\em Best guess of the till time stamp (may be wrong). \item\end{DoxyCompactList}\item 
LCCollection $\ast$ {\bf \_\-col}
\begin{DoxyCompactList}\small\item\em pointer to the clone of the conditions data collection. \item\end{DoxyCompactList}\item 
unsigned int {\bf \_\-changes}
\begin{DoxyCompactList}\small\item\em keep track of the number of changes. \item\end{DoxyCompactList}\item 
unsigned int {\bf \_\-writes}
\begin{DoxyCompactList}\small\item\em keep track of the number of conditions data written to the database. \item\end{DoxyCompactList}\item 
long64 {\bfseries \_\-first}\label{classCALICE_1_1ConditionsDataWriteHandler_a8076fe1b19e269527fa769de5a88a65e}

\item 
long64 {\bfseries \_\-last}\label{classCALICE_1_1ConditionsDataWriteHandler_a5debaace61a41f99d2df0ce318c036bf}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
Handler of conditions data changes which writes the replaced collections to a conditions data base. When ever conditions data changes the old (cloned) collection will be stored with the time stamps of the event just before the former conditions data change and the time stamp of the last event. At the end of the run, the conditions data has to be written manually by calling \doxyref{writeConditionsData()}{p.}{classCALICE_1_1ConditionsDataWriteHandler_a139623a650f56c24a5d32658da9af09b} with the time stamp of the last event. 

Definition at line 40 of file ConditionsDataWriteHandler.hh.

\subsection{Constructor \& Destructor Documentation}
\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!ConditionsDataWriteHandler@{ConditionsDataWriteHandler}}
\index{ConditionsDataWriteHandler@{ConditionsDataWriteHandler}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{ConditionsDataWriteHandler}]{\setlength{\rightskip}{0pt plus 5cm}CALICE::ConditionsDataWriteHandler::ConditionsDataWriteHandler (const std::string \& {\em col\_\-name}, \/  const std::string \& {\em db\_\-init\_\-string}, \/  const std::string \& {\em folder\_\-name}, \/  const std::string \& {\em tag}, \/  const std::string \& {\em description})}\label{classCALICE_1_1ConditionsDataWriteHandler_ae0e0b43ca010d9a424f962480175b110}


constructor. 
\begin{DoxyParams}{Parameters}
\item[{\em col\_\-name}]the name of the to be monitored collection (not needed). \item[{\em db\_\-init\_\-string}]specifier of the database host name, database name, user and password. \item[{\em folder\_\-name}]name of the destination folder. \item[{\em tag}]to be applied at the end of the run to the folder. \item[{\em description}]the description added to every collection written toe the data base. \end{DoxyParams}


Definition at line 15 of file ConditionsDataWriteHandler.cc.

References \_\-changeHandler, \_\-colName, \_\-since, and \_\-till.

\subsection{Member Function Documentation}
\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!conditionsChanged@{conditionsChanged}}
\index{conditionsChanged@{conditionsChanged}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{conditionsChanged}]{\setlength{\rightskip}{0pt plus 5cm}void CALICE::ConditionsDataWriteHandler::conditionsChanged (lcio::LCCollection $\ast$ {\em col})}\label{classCALICE_1_1ConditionsDataWriteHandler_a0289e54f162d87125bce02b71dc46b51}


Be notified if conditions data changes and redirect changes to responsible class. 
\begin{DoxyParams}{Parameters}
\item[{\em col}]the collection containing the new conditions data \end{DoxyParams}


if (\_\-changeHandler) \{ 

Definition at line 59 of file ConditionsDataWriteHandler.cc.

References \_\-changeHandler, \_\-changes, \_\-col, \_\-colName, \_\-since, \_\-till, CALICE::cloneCollection(), and writeConditionsData().\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!setSinceTime@{setSinceTime}}
\index{setSinceTime@{setSinceTime}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{setSinceTime}]{\setlength{\rightskip}{0pt plus 5cm}void CALICE::ConditionsDataWriteHandler::setSinceTime (long64 {\em since\_\-time})\hspace{0.3cm}{\ttfamily  [inline]}}\label{classCALICE_1_1ConditionsDataWriteHandler_aaac4f4263bbfb7a38cfbf0cb6c6ef99b}


Set the correct since time for the current conditions data. The since time will be initialised by the time of the last event. But this is just too early. So, the \doxyref{marlin::ConditionsDataWriter}{p.}{classmarlin_1_1ConditionsDataWriter} has to set the time of the next event. 

Definition at line 78 of file ConditionsDataWriteHandler.hh.

References \_\-since.\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!writeConditionsData@{writeConditionsData}}
\index{writeConditionsData@{writeConditionsData}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{writeConditionsData}]{\setlength{\rightskip}{0pt plus 5cm}void CALICE::ConditionsDataWriteHandler::writeConditionsData (const long64 \& {\em best\_\-guess\_\-of\_\-till\_\-time\_\-stamp})}\label{classCALICE_1_1ConditionsDataWriteHandler_a139623a650f56c24a5d32658da9af09b}


write the conditions data to the conditions database. Must be called at the end of the run to 

Definition at line 112 of file ConditionsDataWriteHandler.cc.

References \_\-col, \_\-colName, \_\-since, and \_\-writes.

Referenced by conditionsChanged().

\subsection{Field Documentation}
\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!\_\-changes@{\_\-changes}}
\index{\_\-changes@{\_\-changes}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{\_\-changes}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int {\bf CALICE::ConditionsDataWriteHandler::\_\-changes}\hspace{0.3cm}{\ttfamily  [private]}}\label{classCALICE_1_1ConditionsDataWriteHandler_a3f95dd0e4ec24fbd1d4df217a679191d}


keep track of the number of changes. 

Definition at line 124 of file ConditionsDataWriteHandler.hh.

Referenced by conditionsChanged().\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!\_\-col@{\_\-col}}
\index{\_\-col@{\_\-col}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{\_\-col}]{\setlength{\rightskip}{0pt plus 5cm}LCCollection$\ast$ {\bf CALICE::ConditionsDataWriteHandler::\_\-col}\hspace{0.3cm}{\ttfamily  [private]}}\label{classCALICE_1_1ConditionsDataWriteHandler_a8db218626a224e54f964cf46054890cb}


pointer to the clone of the conditions data collection. 

Definition at line 121 of file ConditionsDataWriteHandler.hh.

Referenced by conditionsChanged(), writeConditionsData(), and $\sim$ConditionsDataWriteHandler().\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!\_\-since@{\_\-since}}
\index{\_\-since@{\_\-since}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{\_\-since}]{\setlength{\rightskip}{0pt plus 5cm}long64 {\bf CALICE::ConditionsDataWriteHandler::\_\-since}\hspace{0.3cm}{\ttfamily  [private]}}\label{classCALICE_1_1ConditionsDataWriteHandler_ae9c2172504130f906f18d6459823d62b}


the time of the event just before the conditions data changed. 

Definition at line 119 of file ConditionsDataWriteHandler.hh.

Referenced by conditionsChanged(), ConditionsDataWriteHandler(), currentValidSince(), setSinceTime(), and writeConditionsData().\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!\_\-till@{\_\-till}}
\index{\_\-till@{\_\-till}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{\_\-till}]{\setlength{\rightskip}{0pt plus 5cm}long64 {\bf CALICE::ConditionsDataWriteHandler::\_\-till}\hspace{0.3cm}{\ttfamily  [private]}}\label{classCALICE_1_1ConditionsDataWriteHandler_a3867ef683d994f3ab4a00b2ef7ae410c}


Best guess of the till time stamp (may be wrong). 

Definition at line 120 of file ConditionsDataWriteHandler.hh.

Referenced by conditionsChanged(), ConditionsDataWriteHandler(), and currentValidTill().\index{CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}!\_\-writes@{\_\-writes}}
\index{\_\-writes@{\_\-writes}!CALICE::ConditionsDataWriteHandler@{CALICE::ConditionsDataWriteHandler}}
\subsubsection[{\_\-writes}]{\setlength{\rightskip}{0pt plus 5cm}unsigned int {\bf CALICE::ConditionsDataWriteHandler::\_\-writes}\hspace{0.3cm}{\ttfamily  [private]}}\label{classCALICE_1_1ConditionsDataWriteHandler_aafdf1c7e91d569aed9cf422cd77d8fb6}


keep track of the number of conditions data written to the database. 

Definition at line 126 of file ConditionsDataWriteHandler.hh.

Referenced by changes(), numberOfWrites(), and writeConditionsData().

The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
ConditionsDataWriteHandler.hh\item 
ConditionsDataWriteHandler.cc\end{DoxyCompactItemize}
