<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CALICE_USERLIB: marlin::ConditionsDataWriter Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacemarlin.html">marlin</a>::<a class="el" href="classmarlin_1_1ConditionsDataWriter.html">ConditionsDataWriter</a>
  </div>
</div>
<div class="contents">
<h1>marlin::ConditionsDataWriter Class Reference</h1><!-- doxytag: class="marlin::ConditionsDataWriter" -->
<p>Marlin processr which catches selected conditions data changes and writes them to the conditions data base.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>&gt;</code></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a360478d5d28f2e5012ef5e0e5201821a"></a><!-- doxytag: member="marlin::ConditionsDataWriter::newProcessor" ref="a360478d5d28f2e5012ef5e0e5201821a" args="()" -->
Processor *&nbsp;</td><td class="memItemRight" valign="bottom"><b>newProcessor</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a71c0b9b141b58a82aaf7df60939bf114">init</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Install conditions change listener.  <a href="#a71c0b9b141b58a82aaf7df60939bf114"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a943dd58f7e315e2ded7f49a77211eb82"></a><!-- doxytag: member="marlin::ConditionsDataWriter::processRunHeader" ref="a943dd58f7e315e2ded7f49a77211eb82" args="(LCRunHeader *run)" -->
void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a943dd58f7e315e2ded7f49a77211eb82">processRunHeader</a> (LCRunHeader *run)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Do nothing at run start. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#afa20ee1d0fcaa87334896a5e5b86920e">processEvent</a> (LCEvent *evtP)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Memorise the event time stamps.  <a href="#afa20ee1d0fcaa87334896a5e5b86920e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a8ece634cea5d95989d574c128d303006">end</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Write all not yet written conditions data to the conditions data base.  <a href="#a8ece634cea5d95989d574c128d303006"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8c8683f0e6055c27c991a6f31d5d69a9"></a><!-- doxytag: member="marlin::ConditionsDataWriter::getTimeStampOfLastEvent" ref="a8c8683f0e6055c27c991a6f31d5d69a9" args="() const " -->
long64&nbsp;</td><td class="memItemRight" valign="bottom"><b>getTimeStampOfLastEvent</b> () const </td></tr>
<tr><td colspan="2"><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">std::string&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#ad87dadf50a9e475515ea26bce299e449">_dbInit</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">parameter to be filled with the host name, database name,user name and the password.  <a href="#ad87dadf50a9e475515ea26bce299e449"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">StringVec&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#aec7c975d8f23f11e20dc1911ce57bb2c">_condDataCollections</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">collection name, destination CondDB folder and version of the conditions data to be written to the conditions database.  <a href="#aec7c975d8f23f11e20dc1911ce57bb2c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long64&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#af2c6e1b189e2f665f8ef6beb7ad9c10b">_timeStampOfLastEvent</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The time stamp of the last event that was processed.  <a href="#af2c6e1b189e2f665f8ef6beb7ad9c10b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a68d96e4787ed480558b5b3088cd3321f"></a><!-- doxytag: member="marlin::ConditionsDataWriter::_handler" ref="a68d96e4787ed480558b5b3088cd3321f" args="" -->
std::vector<br class="typebreak"/>
&lt; <a class="el" href="classCALICE_1_1ConditionsDataWriteHandler.html">CALICE::ConditionsDataWriteHandler</a> * &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_handler</b></td></tr>
<tr><td colspan="2"><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0e401bb1bfedeba5808934499877adf4"></a><!-- doxytag: member="marlin::ConditionsDataWriter::CALICE::ConditionsDataWriteHandler" ref="a0e401bb1bfedeba5808934499877adf4" args="" -->
class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmarlin_1_1ConditionsDataWriter.html#a0e401bb1bfedeba5808934499877adf4">CALICE::ConditionsDataWriteHandler</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Marlin processr which catches selected conditions data changes and writes them to the conditions data base. </p>
<p>The processor does not verify whether the data already exists it writes every change to the database.</p>
<p>The conditions data changes are catched by individual handlers which clone the conditions data collection and store the cloned collection when the handler is notified of the next change.</p>
<p>The conditions data change handler does not have any knowledge of the record time which triggered the conditions data change. To solve this problem, the handlers request a correction of the since time stamp. This request will be approximatively fulfilled by setting the since time stamp to the time stamp of the event which arrived just after the conditions data change. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00036">36</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8ece634cea5d95989d574c128d303006"></a><!-- doxytag: member="marlin::ConditionsDataWriter::end" ref="a8ece634cea5d95989d574c128d303006" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::end </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Write all not yet written conditions data to the conditions data base. </p>
<p>The writing of the conditions data is delayed until the conditions data changes to set the "since" and "till" time stamps. All the conditions data which is not yet stored in the conditions database is written now. Finally if the the version is not HEAD, the folders are tagged. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00109">109</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

<p>References <a class="el" href="ConditionsDataWriter_8hh_source.html#l00080">_timeStampOfLastEvent</a>.</p>

</div>
</div>
<a class="anchor" id="a71c0b9b141b58a82aaf7df60939bf114"></a><!-- doxytag: member="marlin::ConditionsDataWriter::init" ref="a71c0b9b141b58a82aaf7df60939bf114" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::init </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Install conditions change listener. </p>
<p>The listeners are installed for the conditions data specified by the processor parameters. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00041">41</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

<p>References <a class="el" href="ConditionsDataWriter_8hh_source.html#l00077">_condDataCollections</a>, <a class="el" href="ConditionsDataWriter_8hh_source.html#l00072">_dbInit</a>, and <a class="el" href="ConditionsDataWriter_8hh_source.html#l00080">_timeStampOfLastEvent</a>.</p>

</div>
</div>
<a class="anchor" id="afa20ee1d0fcaa87334896a5e5b86920e"></a><!-- doxytag: member="marlin::ConditionsDataWriter::processEvent" ref="afa20ee1d0fcaa87334896a5e5b86920e" args="(LCEvent *evtP)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void marlin::ConditionsDataWriter::processEvent </td>
          <td>(</td>
          <td class="paramtype">LCEvent *&nbsp;</td>
          <td class="paramname"> <em>evtP</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Memorise the event time stamps. </p>
<p>The time stamp of the last event before the member function end is called is needed to write the dangling conditions data with correct "since" and "till" time stamps to the conditions data base. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8cc_source.html#l00094">94</a> of file <a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a>.</p>

<p>References <a class="el" href="ConditionsDataWriter_8hh_source.html#l00080">_timeStampOfLastEvent</a>.</p>

</div>
</div>
<hr/><h2>Field Documentation</h2>
<a class="anchor" id="aec7c975d8f23f11e20dc1911ce57bb2c"></a><!-- doxytag: member="marlin::ConditionsDataWriter::_condDataCollections" ref="aec7c975d8f23f11e20dc1911ce57bb2c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">StringVec <a class="el" href="classmarlin_1_1ConditionsDataWriter.html#aec7c975d8f23f11e20dc1911ce57bb2c">marlin::ConditionsDataWriter::_condDataCollections</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>collection name, destination CondDB folder and version of the conditions data to be written to the conditions database. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00077">77</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

<p>Referenced by <a class="el" href="ConditionsDataWriter_8cc_source.html#l00041">init()</a>.</p>

</div>
</div>
<a class="anchor" id="ad87dadf50a9e475515ea26bce299e449"></a><!-- doxytag: member="marlin::ConditionsDataWriter::_dbInit" ref="ad87dadf50a9e475515ea26bce299e449" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string <a class="el" href="classmarlin_1_1ConditionsDataWriter.html#ad87dadf50a9e475515ea26bce299e449">marlin::ConditionsDataWriter::_dbInit</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>parameter to be filled with the host name, database name,user name and the password. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00072">72</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

<p>Referenced by <a class="el" href="ConditionsDataWriter_8cc_source.html#l00041">init()</a>.</p>

</div>
</div>
<a class="anchor" id="af2c6e1b189e2f665f8ef6beb7ad9c10b"></a><!-- doxytag: member="marlin::ConditionsDataWriter::_timeStampOfLastEvent" ref="af2c6e1b189e2f665f8ef6beb7ad9c10b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long64 <a class="el" href="classmarlin_1_1ConditionsDataWriter.html#af2c6e1b189e2f665f8ef6beb7ad9c10b">marlin::ConditionsDataWriter::_timeStampOfLastEvent</a><code> [protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The time stamp of the last event that was processed. </p>

<p>Definition at line <a class="el" href="ConditionsDataWriter_8hh_source.html#l00080">80</a> of file <a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a>.</p>

<p>Referenced by <a class="el" href="ConditionsDataWriter_8cc_source.html#l00109">end()</a>, <a class="el" href="ConditionsDataWriter_8cc_source.html#l00041">init()</a>, <a class="el" href="ConditionsDataWriter_8cc_source.html#l00094">processEvent()</a>, and <a class="el" href="ConditionsDataWriter_8cc_source.html#l00077">processRunHeader()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="ConditionsDataWriter_8hh_source.html">ConditionsDataWriter.hh</a></li>
<li><a class="el" href="ConditionsDataWriter_8cc_source.html">ConditionsDataWriter.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2017 for CALICE_USERLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
