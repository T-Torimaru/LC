<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CALICE_USERLIB: AhcTempProvider.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_36843d1d4246be2b2ac1dd04c3c30114.html">calice_userlib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_93ce9fa9a1b0f4d1db89ce4de6453d6d.html">src</a>
  </div>
</div>
<div class="contents">
<h1>AhcTempProvider.cc</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;AhcTempProvider.hh&quot;</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">using namespace </span>lcio;
<a name="l00004"></a>00004 
<a name="l00005"></a>00005 <span class="keyword">namespace </span>CALICE {
<a name="l00006"></a>00006   
<a name="l00007"></a><a class="code" href="classCALICE_1_1AhcTempProvider.html#ab4f94c3219c7389ce3871daea4396b4a">00007</a>   <a class="code" href="classCALICE_1_1AhcTempProvider.html#ab4f94c3219c7389ce3871daea4396b4a" title="Default constructor.">AhcTempProvider::AhcTempProvider</a>()
<a name="l00008"></a>00008     : newSroModCol(true), newCalibCol(true), newSanityRange(true),
<a name="l00009"></a>00009       _sanityMin(0), _sanityMax(300), _sroModCol(0), _calibCol(0)
<a name="l00010"></a>00010   {
<a name="l00011"></a>00011     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a4e5a07c38f63a12bc38eebff556ac750" title="This is a &amp;#39;cache&amp;#39; for the values of the temperature sensors after calibration...">sensorTemp</a>.resize(N_MODULES);
<a name="l00012"></a>00012     <a class="code" href="classCALICE_1_1AhcTempProvider.html#acf152646f43cf38d95af642369fc7b71" title="This is a &amp;#39;cache&amp;#39; for the errors on the values of the temperature sensors...">sensorTempError</a>.resize(N_MODULES);
<a name="l00013"></a>00013     <a class="code" href="classCALICE_1_1AhcTempProvider.html#ad4116a88a804429437ab8c940d555eba" title="This is a &amp;#39;cache&amp;#39; for the calibration offsets for the temperature sensors...">sensorCalib</a>.resize(N_MODULES);
<a name="l00014"></a>00014     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a9a8b275ae8bf46f0ac30504ce2b437b0" title="This is a &amp;#39;cache&amp;#39; for the errors on the calibration offsets for the temperature...">sensorCalibError</a>.resize(N_MODULES);
<a name="l00015"></a>00015     <a class="code" href="classCALICE_1_1AhcTempProvider.html#af49e3cc723e4ce780660fe181fd2b40f" title="Vector to save the status of the calibration offsets.">sensorCalibStatus</a>.resize(   N_MODULES);
<a name="l00016"></a>00016  
<a name="l00017"></a>00017     <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> i=0; i&lt;N_MODULES; i++) {
<a name="l00018"></a>00018       <a class="code" href="classCALICE_1_1AhcTempProvider.html#a4e5a07c38f63a12bc38eebff556ac750" title="This is a &amp;#39;cache&amp;#39; for the values of the temperature sensors after calibration...">sensorTemp</a>[i].resize(N_SENSORS,-1);
<a name="l00019"></a>00019       <a class="code" href="classCALICE_1_1AhcTempProvider.html#acf152646f43cf38d95af642369fc7b71" title="This is a &amp;#39;cache&amp;#39; for the errors on the values of the temperature sensors...">sensorTempError</a>[i].resize(N_SENSORS,-1);
<a name="l00020"></a>00020       <a class="code" href="classCALICE_1_1AhcTempProvider.html#ad4116a88a804429437ab8c940d555eba" title="This is a &amp;#39;cache&amp;#39; for the calibration offsets for the temperature sensors...">sensorCalib</a>[i].resize(N_SENSORS,0);
<a name="l00021"></a>00021       <a class="code" href="classCALICE_1_1AhcTempProvider.html#a9a8b275ae8bf46f0ac30504ce2b437b0" title="This is a &amp;#39;cache&amp;#39; for the errors on the calibration offsets for the temperature...">sensorCalibError</a>[i].resize(N_SENSORS,0);
<a name="l00022"></a>00022       <a class="code" href="classCALICE_1_1AhcTempProvider.html#af49e3cc723e4ce780660fe181fd2b40f" title="Vector to save the status of the calibration offsets.">sensorCalibStatus</a>[i].resize(   N_SENSORS, 0);
<a name="l00023"></a>00023     }
<a name="l00024"></a>00024   }
<a name="l00025"></a>00025   
<a name="l00026"></a>00026   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1AhcTempProvider.html#a938c5064c310531a44b5ba6905dc1705" title="Set the collection of AhcSlowReadoutModBlock objects to extract the temperature data...">AhcTempProvider::setAhcSroModBlocks</a>( LCCollection* col )
<a name="l00027"></a>00027   {
<a name="l00028"></a>00028     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a6d03fdcfc0a4fedc590597f4383d36ae" title="A pointer to the LCCollection containing the AhcSlowReadOut objects.">_sroModCol</a> = col;
<a name="l00029"></a>00029     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a74d1c14bbe08ef50cacf1b52c2731904" title="If true this indicates that setSroModBlocks() was called and a new collection of...">newSroModCol</a> = <span class="keyword">true</span>;
<a name="l00030"></a>00030   }
<a name="l00031"></a>00031   
<a name="l00032"></a>00032   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1AhcTempProvider.html#a9d3babda133b664e703113bb7b47dbdd" title="Set the collection of SimpleValue objects to use for the offset calibrations of the...">AhcTempProvider::setCalibrations</a>( LCCollection* col )
<a name="l00033"></a>00033   {
<a name="l00034"></a>00034     <span class="keywordflow">if</span>(!col) <span class="keywordflow">throw</span> std::logic_error(<span class="stringliteral">&quot;AhcTempProvider::setCalibrations(): &quot;</span>
<a name="l00035"></a>00035                                     <span class="stringliteral">&quot;Null pointer col!&quot;</span>);
<a name="l00036"></a>00036     
<a name="l00037"></a>00037     <a class="code" href="classCALICE_1_1AhcTempProvider.html#aed886ffef7d22bdcfbfa4e00b6c27f9f" title="A pointer to the LCCollection containing the calibration offsets objects.">_calibCol</a> = col;
<a name="l00038"></a>00038     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a5d97a51401f30bf5afed91749503a2f5" title="If true this indicates that setCalibrations() was called and a new collection of...">newCalibCol</a> = <span class="keyword">true</span>;
<a name="l00039"></a>00039     
<a name="l00040"></a>00040     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i &lt; col-&gt;getNumberOfElements(); i++ ) {
<a name="l00041"></a>00041         <a class="code" href="classCALICE_1_1SimpleValue.html" title="Class to store float value, its error, and status flag plus integer index in LCIO...">CALICE::SimpleValue</a> sv( col-&gt;getElementAt(i) );
<a name="l00042"></a>00042         
<a name="l00043"></a>00043         AhcTempSensorIndex idx( sv.getCellID() );
<a name="l00044"></a>00044         
<a name="l00045"></a>00045         <a class="code" href="classCALICE_1_1AhcTempProvider.html#ad4116a88a804429437ab8c940d555eba" title="This is a &amp;#39;cache&amp;#39; for the calibration offsets for the temperature sensors...">sensorCalib</a>[idx.getModule()-1][idx.getSensor()]       = sv.getValue();
<a name="l00046"></a>00046         <a class="code" href="classCALICE_1_1AhcTempProvider.html#a9a8b275ae8bf46f0ac30504ce2b437b0" title="This is a &amp;#39;cache&amp;#39; for the errors on the calibration offsets for the temperature...">sensorCalibError</a>[idx.getModule()-1][idx.getSensor()]  = sv.getError();
<a name="l00047"></a>00047         <a class="code" href="classCALICE_1_1AhcTempProvider.html#af49e3cc723e4ce780660fe181fd2b40f" title="Vector to save the status of the calibration offsets.">sensorCalibStatus</a>[idx.getModule()-1][idx.getSensor()] = sv.getStatus();
<a name="l00048"></a>00048 
<a name="l00049"></a>00049     }
<a name="l00050"></a>00050   }
<a name="l00051"></a>00051   
<a name="l00052"></a><a class="code" href="classCALICE_1_1AhcTempProvider.html#add95eab55a99250ec9f0666fc34ba40d">00052</a>   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1AhcTempProvider.html#add95eab55a99250ec9f0666fc34ba40d" title="Define a sanity range of temperature values that make sense.">AhcTempProvider::setSanityRange</a>( <span class="keywordtype">float</span> min, <span class="keywordtype">float</span> max )
<a name="l00053"></a>00053   {
<a name="l00054"></a>00054     <a class="code" href="classCALICE_1_1AhcTempProvider.html#acdf8e26d39ac276e7eac53b2746348c2" title="Lower limit of the sanity range.">_sanityMin</a> = min;
<a name="l00055"></a>00055     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a5c8919447ae0eece8b050ea21bc80e15" title="Upper limit of the sanity range.">_sanityMax</a> = max;
<a name="l00056"></a>00056     <a class="code" href="classCALICE_1_1AhcTempProvider.html#afc923ba1a81304d4165060e6cb8bfe87" title="If true this indicates that setSanityRange() was called and a new sanity range was...">newSanityRange</a> = <span class="keyword">true</span>;
<a name="l00057"></a>00057   }
<a name="l00058"></a>00058   
<a name="l00059"></a><a class="code" href="classCALICE_1_1AhcTempProvider.html#aaf2e7780e46882ba4fe8755c8bad2237">00059</a>   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1AhcTempProvider.html#aaf2e7780e46882ba4fe8755c8bad2237" title="This function updates the internal &amp;#39;cache&amp;#39; for the temperature values from...">AhcTempProvider::updateCache</a>()
<a name="l00060"></a>00060   {
<a name="l00061"></a>00061     <span class="keywordflow">if</span>(!<a class="code" href="classCALICE_1_1AhcTempProvider.html#a6d03fdcfc0a4fedc590597f4383d36ae" title="A pointer to the LCCollection containing the AhcSlowReadOut objects.">_sroModCol</a>) <span class="keywordflow">throw</span> std::invalid_argument( <span class="stringliteral">&quot;AhcSimpleTempProvider::&quot;</span>
<a name="l00062"></a>00062                                                  <span class="stringliteral">&quot;updateCache(): &quot;</span>
<a name="l00063"></a>00063                                                  <span class="stringliteral">&quot; null pointer _sroModCol!&quot;</span> );
<a name="l00064"></a>00064     
<a name="l00065"></a>00065     <span class="comment">//for each module</span>
<a name="l00066"></a>00066     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="classCALICE_1_1AhcTempProvider.html#a6d03fdcfc0a4fedc590597f4383d36ae" title="A pointer to the LCCollection containing the AhcSlowReadOut objects.">_sroModCol</a>-&gt;getNumberOfElements(); i++ ) {
<a name="l00067"></a>00067       <a class="code" href="classCALICE_1_1AhcSlowReadoutModBlock.html" title="Interface Class to access the AhcSlowReadout Data Here we handle ahc voltages, temperatures...">AhcSlowReadoutModBlock</a> mb( <a class="code" href="classCALICE_1_1AhcTempProvider.html#a6d03fdcfc0a4fedc590597f4383d36ae" title="A pointer to the LCCollection containing the AhcSlowReadOut objects.">_sroModCol</a>-&gt;getElementAt(i) );
<a name="l00068"></a>00068       
<a name="l00069"></a>00069       <span class="keywordtype">int</span> module = mb.getModuleNumber()-1;
<a name="l00070"></a>00070       
<a name="l00071"></a>00071       <span class="keywordflow">if</span>(mb.getCmbTemperatures().size()==0) {
<a name="l00072"></a>00072         cout&lt;&lt;<span class="stringliteral">&quot;WARNING no cmb temperatures for module &quot;</span>&lt;&lt;mb.getModuleNumber()
<a name="l00073"></a>00073             &lt;&lt;endl;
<a name="l00074"></a>00074       } 
<a name="l00075"></a>00075       <span class="keywordflow">for</span>(<span class="keywordtype">unsigned</span> s=0; s&lt;N_SENSORS &amp;&amp; s&lt;mb.getCmbTemperatures().size(); s++)
<a name="l00076"></a>00076         {
<a name="l00077"></a>00077           <span class="comment">//get temperature</span>
<a name="l00078"></a>00078           <a class="code" href="classCALICE_1_1AhcTempProvider.html#a4e5a07c38f63a12bc38eebff556ac750" title="This is a &amp;#39;cache&amp;#39; for the values of the temperature sensors after calibration...">sensorTemp</a>[module][s] = mb.getCmbTemperatures()[s];
<a name="l00079"></a>00079           
<a name="l00080"></a>00080           <span class="comment">//calibrate </span>
<a name="l00081"></a>00081             <span class="keywordflow">if</span>( <a class="code" href="classCALICE_1_1AhcTempProvider.html#aed886ffef7d22bdcfbfa4e00b6c27f9f" title="A pointer to the LCCollection containing the calibration offsets objects.">_calibCol</a> ) {
<a name="l00082"></a>00082               <a class="code" href="classCALICE_1_1AhcTempProvider.html#a4e5a07c38f63a12bc38eebff556ac750" title="This is a &amp;#39;cache&amp;#39; for the values of the temperature sensors after calibration...">sensorTemp</a>[module][s] += sensorCalib[module][s];
<a name="l00083"></a>00083             }
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085     }
<a name="l00086"></a>00086     
<a name="l00087"></a>00087     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a5d97a51401f30bf5afed91749503a2f5" title="If true this indicates that setCalibrations() was called and a new collection of...">newCalibCol</a> = <span class="keyword">false</span>;
<a name="l00088"></a>00088     <a class="code" href="classCALICE_1_1AhcTempProvider.html#a74d1c14bbe08ef50cacf1b52c2731904" title="If true this indicates that setSroModBlocks() was called and a new collection of...">newSroModCol</a> = <span class="keyword">false</span>;
<a name="l00089"></a>00089   }
<a name="l00090"></a>00090   
<a name="l00091"></a>00091 }
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2017 for CALICE_USERLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
