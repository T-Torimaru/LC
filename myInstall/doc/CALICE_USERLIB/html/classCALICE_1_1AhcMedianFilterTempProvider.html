<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CALICE_USERLIB: CALICE::AhcMedianFilterTempProvider Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Data&nbsp;Fields</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespaceCALICE.html">CALICE</a>::<a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html">AhcMedianFilterTempProvider</a>
  </div>
</div>
<div class="contents">
<h1>CALICE::AhcMedianFilterTempProvider Class Reference</h1><!-- doxytag: class="CALICE::AhcMedianFilterTempProvider" --><!-- doxytag: inherits="CALICE::AhcTempProvider" -->
<p>This is a very simple temperature provider for the ahcal.  
<a href="#_details">More...</a></p>

<p><code>#include &lt;<a class="el" href="AhcMedianFilterTempProvider_8hh_source.html">AhcMedianFilterTempProvider.hh</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for CALICE::AhcMedianFilterTempProvider:</div>
<div class="dynsection">
 <div class="center">
  <img src="classCALICE_1_1AhcMedianFilterTempProvider.gif" usemap="#CALICE::AhcMedianFilterTempProvider_map" alt=""/>
  <map id="CALICE::AhcMedianFilterTempProvider_map" name="CALICE::AhcMedianFilterTempProvider_map">
<area href="classCALICE_1_1AhcTempProvider.html" alt="CALICE::AhcTempProvider" shape="rect" coords="0,0,236,24"/>
</map>
 </div>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afc6895b4468f12307c2da9f64c3eb5ed"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::AhcMedianFilterTempProvider" ref="afc6895b4468f12307c2da9f64c3eb5ed" args="(AhcMapper const *mapper)" -->
&nbsp;</td><td class="memItemRight" valign="bottom"><b>AhcMedianFilterTempProvider</b> (<a class="el" href="classCALICE_1_1AhcMapper.html">AhcMapper</a> const *mapper)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a2d5865711d94a975e593df2713608880">getCellTemp</a> (int module, int chip, int chan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the temperature for the cell in the specified module connected to the given chip and channel.  <a href="#a2d5865711d94a975e593df2713608880"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace083f026078087a40383dd051d34843"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getCellTempError" ref="ace083f026078087a40383dd051d34843" args="(int module, int chip, int chan)" -->
virtual float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#ace083f026078087a40383dd051d34843">getCellTempError</a> (int module, int chip, int chan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the error on the temperature for the cell in the specified module connected to the given chip and channel. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a237fba51962e5102c9580cfa9ed431fa"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getAvgTemp" ref="a237fba51962e5102c9580cfa9ed431fa" args="()" -->
virtual float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a237fba51962e5102c9580cfa9ed431fa">getAvgTemp</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the average calorimeter temperature. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5395b7d6095c39af7e0b80b133ba400d"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getAvgModuleTemp" ref="a5395b7d6095c39af7e0b80b133ba400d" args="(unsigned module)" -->
virtual float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a5395b7d6095c39af7e0b80b133ba400d">getAvgModuleTemp</a> (unsigned module)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the average module temperature. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac9f730849a87bda3106773b7dc869f2e"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getSensorTemp" ref="ac9f730849a87bda3106773b7dc869f2e" args="(int module, int sensor)" -->
float&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#ac9f730849a87bda3106773b7dc869f2e">getSensorTemp</a> (int module, int sensor)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return the temperature for the specified module and sensor. <br/></td></tr>
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a9ffdad9db5836b0ceb55f317095cfe8c">applyCorrection</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">This function applies the correction to the internal 'cache' for the temperature values from the five sensors.  <a href="#a9ffdad9db5836b0ceb55f317095cfe8c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a708c84d516d63059ba6665dae2da147e"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::isBadValue" ref="a708c84d516d63059ba6665dae2da147e" args="(float t)" -->
bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a708c84d516d63059ba6665dae2da147e">isBadValue</a> (float t)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns true if argument value is outside the sanity range. <br/></td></tr>
<tr><td colspan="2"><h2>Private Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a23a23ba36d563be88a3f1a20a51b28c9"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getSensor" ref="a23a23ba36d563be88a3f1a20a51b28c9" args="(int chip, int chan)" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a23a23ba36d563be88a3f1a20a51b28c9">getSensor</a> (int chip, int chan)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns the closest sensor to cell connected to chip, chan according to DESY-THESIS-2008-050. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acab9513cd7e4395371bde8d433177cdb"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::median" ref="acab9513cd7e4395371bde8d433177cdb" args="(float a[], int n)" -->
double&nbsp;</td><td class="memItemRight" valign="bottom"><b>median</b> (float a[], int n)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa401791e44b7cc8c0c9093b66d84ac6a"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_mapper" ref="aa401791e44b7cc8c0c9093b66d84ac6a" args="" -->
<a class="el" href="classCALICE_1_1AhcMapper.html">AhcMapper</a> const *&nbsp;</td><td class="memItemRight" valign="bottom"><b>_mapper</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a76bfbd1b9fd6deead5eeaf572f2498ef"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_caloMeanTemp" ref="a76bfbd1b9fd6deead5eeaf572f2498ef" args="" -->
float&nbsp;</td><td class="memItemRight" valign="bottom"><b>_caloMeanTemp</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a73f567416a0bcb8b5f8a130df8cad1f3"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_caloMeanTempRMS" ref="a73f567416a0bcb8b5f8a130df8cad1f3" args="" -->
float&nbsp;</td><td class="memItemRight" valign="bottom"><b>_caloMeanTempRMS</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abfa3e2672c774bc6814b5f44eda6ba9a"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_caloMeanCount" ref="abfa3e2672c774bc6814b5f44eda6ba9a" args="" -->
int&nbsp;</td><td class="memItemRight" valign="bottom"><b>_caloMeanCount</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a20f5463fcf3ba997a6b081615830940f"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_moduleMeanTemp" ref="a20f5463fcf3ba997a6b081615830940f" args="" -->
std::vector&lt; float &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_moduleMeanTemp</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aecb3f33637742eb7af6b9e0cbdb276a8"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_moduleMeanTempRMS" ref="aecb3f33637742eb7af6b9e0cbdb276a8" args="" -->
std::vector&lt; float &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_moduleMeanTempRMS</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a17ece36832271a1590d721aabc0ce7ed"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::_moduleMeanCount" ref="a17ece36832271a1590d721aabc0ce7ed" args="" -->
std::vector&lt; int &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><b>_moduleMeanCount</b></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>This is a very simple temperature provider for the ahcal. </p>
<p>What it does:</p>
<ul>
<li>the calibration set is applied</li>
<li>if a temperature sensor gives a value outside the defined sanity range the value is replaced by the average of the four sensors in that module</li>
<li>for each cell the temperature value from the 'closest' sensor, according to the table 3.1, DESY-THESIS-2008-050 is returned</li>
</ul>
<p>Also see the documentation for the several functions for more detailed information. This new temperature provider with median filter created: Date: August 2013 Author: Sergey Morozov The temperature provider is based on the <a class="el" href="classCALICE_1_1AhcSimpleTempProvider.html" title="This is a very simple temperature provider for the ahcal.">AhcSimpleTempProvider</a> with some updates:</p>
<ul>
<li>all temperature sensors are set to the layer average temperature.</li>
<li>the median filter to layer-by-layer profile has been introduced. This will help to remove the out-layers with wrong temperature measurements in some layers of AHCAL. Note: you need smooth (median filtered for example) MIP and gain temperature profiles in the MIP and gain calibrations to use this tempetarure provider for data reconstruction! </li>
</ul>

<p>Definition at line <a class="el" href="AhcMedianFilterTempProvider_8hh_source.html#l00038">38</a> of file <a class="el" href="AhcMedianFilterTempProvider_8hh_source.html">AhcMedianFilterTempProvider.hh</a>.</p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a9ffdad9db5836b0ceb55f317095cfe8c"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::applyCorrection" ref="a9ffdad9db5836b0ceb55f317095cfe8c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CALICE::AhcMedianFilterTempProvider::applyCorrection </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>This function applies the correction to the internal 'cache' for the temperature values from the five sensors. </p>
<p>It should be called everytime a new collection of temperatures or calibrations have been at set or the sanity range has been changed, i.e. if one of newSroModCol, newCalibCol or newSanityRange is true. This is done in <a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#a2d5865711d94a975e593df2713608880" title="Returns the temperature for the cell in the specified module connected to the given...">getCellTemp()</a> and <a class="el" href="classCALICE_1_1AhcMedianFilterTempProvider.html#ace083f026078087a40383dd051d34843" title="Returns the error on the temperature for the cell in the specified module connected...">getCellTempError()</a>. </p>

<p>Definition at line <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00097">97</a> of file <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html">AhcMedianFilterTempProvider.cc</a>.</p>

<p>References <a class="el" href="AhcTempProvider_8hh_source.html#l00171">CALICE::AhcTempProvider::_sroModCol</a>, <a class="el" href="AhcMapper_8hh_source.html#l00531">CALICE::AhcMapper::getK()</a>, <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00092">isBadValue()</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00116">CALICE::AhcTempProvider::newCalibCol</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00123">CALICE::AhcTempProvider::newSanityRange</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00109">CALICE::AhcTempProvider::newSroModCol</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00132">CALICE::AhcTempProvider::sensorTemp</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00142">CALICE::AhcTempProvider::sensorTempError</a>, and <a class="el" href="AhcTempProvider_8cc_source.html#l00059">CALICE::AhcTempProvider::updateCache()</a>.</p>

<p>Referenced by <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00039">getAvgModuleTemp()</a>, <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00049">getAvgTemp()</a>, <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00019">getCellTemp()</a>, <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00029">getCellTempError()</a>, and <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00059">getSensorTemp()</a>.</p>

</div>
</div>
<a class="anchor" id="a2d5865711d94a975e593df2713608880"></a><!-- doxytag: member="CALICE::AhcMedianFilterTempProvider::getCellTemp" ref="a2d5865711d94a975e593df2713608880" args="(int module, int chip, int chan)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">float CALICE::AhcMedianFilterTempProvider::getCellTemp </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>module</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>chan</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns the temperature for the cell in the specified module connected to the given chip and channel. </p>
<p>For each cell the temperature value from the 'closest' sensor, according to the table 3.1, DESY-THESIS-2008-050 is returned. </p>

<p>Implements <a class="el" href="classCALICE_1_1AhcTempProvider.html#aa12c75d45d7ade54316dd113a6bab2d1">CALICE::AhcTempProvider</a>.</p>

<p>Definition at line <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00019">19</a> of file <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html">AhcMedianFilterTempProvider.cc</a>.</p>

<p>References <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00097">applyCorrection()</a>, <a class="el" href="AhcMedianFilterTempProvider_8cc_source.html#l00078">getSensor()</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00116">CALICE::AhcTempProvider::newCalibCol</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00123">CALICE::AhcTempProvider::newSanityRange</a>, <a class="el" href="AhcTempProvider_8hh_source.html#l00109">CALICE::AhcTempProvider::newSroModCol</a>, and <a class="el" href="AhcTempProvider_8hh_source.html#l00132">CALICE::AhcTempProvider::sensorTemp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="AhcMedianFilterTempProvider_8hh_source.html">AhcMedianFilterTempProvider.hh</a></li>
<li><a class="el" href="AhcMedianFilterTempProvider_8cc_source.html">AhcMedianFilterTempProvider.cc</a></li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2017 for CALICE_USERLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
