<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CALICE_USERLIB: MappingAndAlignment.hh Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_36843d1d4246be2b2ac1dd04c3c30114.html">calice_userlib</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_57be4fcabe5c93cdea47fb40369601ff.html">include</a>
  </div>
</div>
<div class="contents">
<h1>MappingAndAlignment.hh</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifdef USE_LCCD</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#ifndef MappingAndAlignment_hh</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#define MappingAndAlignment_hh</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00007"></a>00007 <span class="preprocessor">#include &lt;utility&gt;</span>
<a name="l00008"></a>00008 <span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="preprocessor">#include &lt;ModuleConnection.hh&gt;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &lt;TcmtConnection.hh&gt;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &lt;Alignment.hh&gt;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &lt;SimpleArray_t.hh&gt;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &lt;CellIndex.hh&gt;</span>
<a name="l00016"></a>00016 <span class="comment">//Come define statements as given in CellIndex Class</span>
<a name="l00017"></a>00017 <span class="preprocessor">#define SHIFT_M 0</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#define MASK_M (UInt_t) 0x00000007</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a>00020 <span class="preprocessor">#if ( __GNUC__ &lt; 3 )</span>
<a name="l00021"></a>00021 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;math.h&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#else</span>
<a name="l00023"></a>00023 <span class="preprocessor"></span><span class="preprocessor">#  include &lt;cmath&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#endif</span>
<a name="l00025"></a>00025 <span class="preprocessor"></span>
<a name="l00026"></a>00026 <span class="keyword">using namespace </span>std;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="keyword">namespace </span>CALICE {
<a name="l00029"></a>00029 
<a name="l00043"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html">00043</a> <span class="keyword">class </span><a class="code" href="classCALICE_1_1MappingAndAlignment.html" title="Class to comunicate/handle the translation into unique layer/cell ids and 3D spacial...">MappingAndAlignment</a> : <span class="keyword">public</span> <a class="code" href="classCALICE_1_1Alignment.html" title="Class to comunicate/handle the translation into unique layer/cell ids and 3D spacial...">Alignment</a>
<a name="l00044"></a>00044 {
<a name="l00045"></a>00045   <span class="keyword">friend</span> <span class="keyword">class </span>VRawADCValueProcessor;
<a name="l00046"></a>00046   <span class="keyword">friend</span> <span class="keyword">class </span>ModuleIndexReverseLookup;
<a name="l00047"></a>00047   <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCALICE_1_1HcalModuleIndexReverseLookup.html" title="Class to simplify the lookup geometrical index to hardware index.">HcalModuleIndexReverseLookup</a>;
<a name="l00048"></a>00048 <span class="keyword">public</span>:
<a name="l00052"></a>00052   <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a14eb3de5a8df0c6929a768d33f4efd08" title="default constructor.">MappingAndAlignment</a>();
<a name="l00053"></a>00053 
<a name="l00054"></a>00054   ~<a class="code" href="classCALICE_1_1MappingAndAlignment.html" title="Class to comunicate/handle the translation into unique layer/cell ids and 3D spacial...">MappingAndAlignment</a>() {
<a name="l00055"></a>00055     <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ac0bfe9fec7fc2b8a6c0196e61429b558" title="Reset TCMT connection mappings.">clearTcmtConnections</a>();
<a name="l00056"></a>00056   }
<a name="l00057"></a>00057 
<a name="l00060"></a>00060   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ab65734fd9a72ab2d06cc6d9943f426b5" title="Does noting for the time beeing.">init</a>();
<a name="l00061"></a>00061 
<a name="l00076"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#aa6ce2c69a9cb90058716e5bdb757d358">00076</a>    std::pair&lt;UInt_t,UInt_t&gt; <a class="code" href="classCALICE_1_1MappingAndAlignment.html#aa6ce2c69a9cb90058716e5bdb757d358" title="Get the module indices connected to the right and left side of the given front-end...">getModuleIndex</a>(UInt_t crate_id, UInt_t slot_id, UInt_t front_end_nr) <span class="keyword">const</span>
<a name="l00077"></a>00077     <span class="keywordflow">throw</span> (runtime_error
<a name="l00078"></a>00078 #ifdef BOUNDARY_CHECK
<a name="l00079"></a>00079            ,range_error
<a name="l00080"></a>00080 #endif
<a name="l00081"></a>00081            )
<a name="l00082"></a>00082   {
<a name="l00083"></a>00083 
<a name="l00084"></a>00084     <span class="keywordflow">for</span>(CrateList_t::const_iterator crate_iter=_crateList.begin(); 
<a name="l00085"></a>00085         crate_iter!=_crateList.end();
<a name="l00086"></a>00086         crate_iter++) {
<a name="l00087"></a>00087       <span class="keywordflow">if</span> (crate_iter-&gt;first==crate_id) {
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">//      if (slot_id&gt;=crate_iter-&gt;second.size()) {</span>
<a name="l00090"></a>00090         <span class="comment">//        return make_pair&lt;UInt_t,UInt_t&gt;(UINT_MAX,UINT_MAX);</span>
<a name="l00091"></a>00091         <span class="comment">//      }</span>
<a name="l00092"></a>00092         <span class="comment">//#ifdef BOUNDARY_CHECK</span>
<a name="l00093"></a>00093         <span class="comment">//      if (slot_id&gt;=crate_iter-&gt;second.size()) {</span>
<a name="l00094"></a>00094         <span class="comment">//        throw std::range_error(&quot;MappingAndAlignment::getModuleIndex&gt;Slot index out of range.&quot;);</span>
<a name="l00095"></a>00095         <span class="comment">//      }</span>
<a name="l00096"></a>00096         <span class="comment">//#endif        </span>
<a name="l00097"></a>00097         <span class="keywordflow">if</span> (slot_id&gt;=crate_iter-&gt;second.size() || crate_iter-&gt;second[slot_id].size()==0) {
<a name="l00098"></a>00098           <span class="comment">// Slot is not configured i.e. AdcBlocks are not for me.</span>
<a name="l00099"></a>00099           <span class="keywordflow">return</span> std::make_pair&lt;UInt_t,UInt_t&gt;(UINT_MAX,UINT_MAX);
<a name="l00100"></a>00100         }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102         UInt_t front_end_index=front_end_nr*2;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (front_end_index&gt;=(UInt_t) crate_iter-&gt;second[slot_id].size()) {
<a name="l00106"></a>00106           std::stringstream message;
<a name="l00107"></a>00107           message &lt;&lt; <span class="stringliteral">&quot;MappingAndAlignment::getModuleAndCellIndex&gt; Front-end index &quot;</span> &lt;&lt; front_end_nr
<a name="l00108"></a>00108                   &lt;&lt; <span class="stringliteral">&quot; of slot &quot;</span> &lt;&lt; slot_id
<a name="l00109"></a>00109                   &lt;&lt;  <span class="stringliteral">&quot; out of the allowed range (0-7).&quot;</span>;
<a name="l00110"></a>00110               
<a name="l00111"></a>00111           <span class="keywordflow">throw</span> std::range_error(message.str());
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113 <span class="preprocessor">#endif  </span>
<a name="l00114"></a>00114 <span class="preprocessor"></span>
<a name="l00115"></a>00115         UInt_t module_index_left=crate_iter-&gt;second[slot_id][front_end_index];
<a name="l00116"></a>00116         UInt_t module_index_right=crate_iter-&gt;second[slot_id][front_end_index+1];
<a name="l00117"></a>00117 
<a name="l00118"></a>00118         <span class="keywordflow">return</span> std::make_pair&lt;UInt_t,UInt_t&gt;( (<a class="code" href="classCALICE_1_1Alignment.html#a4860425f1c86fbc897920647f0dd7451" title="Return false if the module index is out of range.">isModule</a>(module_index_left) ? module_index_left : UINT_MAX),
<a name="l00119"></a>00119                                               (<a class="code" href="classCALICE_1_1Alignment.html#a4860425f1c86fbc897920647f0dd7451" title="Return false if the module index is out of range.">isModule</a>(module_index_right) ? module_index_right : UINT_MAX) );
<a name="l00120"></a>00120       }
<a name="l00121"></a>00121     }
<a name="l00122"></a>00122     <span class="keywordflow">return</span> std::make_pair&lt;UInt_t,UInt_t&gt;(UINT_MAX,UINT_MAX);
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124 
<a name="l00134"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#ab51a0f33e8d02234ddc96a399a02e9be">00134</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ab51a0f33e8d02234ddc96a399a02e9be" title="get the cell index for the given module according to the current multiplex position...">getCellIndex</a>(UInt_t module_index, UInt_t multiplex_position, UInt_t line_i)<span class="keyword"> const </span>{
<a name="l00135"></a>00135     <span class="keywordflow">return</span> multiplex_position*(getNCellsPerModule(module_index) &gt; 108 ?  <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a251b86e88d0f7c13697e9bdce8a324f8" title="some constants">__nLines</a> : __nLinesHalf )+line_i;
<a name="l00136"></a>00136   }
<a name="l00137"></a>00137 
<a name="l00155"></a>00155   <span class="comment">//  pair&lt;UInt_t, UInt_t&gt; getModuleAndCellIndex(const AdcBlock &amp;adc_block, UInt_t line_i) const</span>
<a name="l00156"></a>00156   <span class="comment">//    throw (runtime_error</span>
<a name="l00157"></a>00157   <span class="comment">//#ifdef BOUNDARY_CHECK</span>
<a name="l00158"></a>00158   <span class="comment">//       ,range_error</span>
<a name="l00159"></a>00159   <span class="comment">//#endif</span>
<a name="l00160"></a>00160   <span class="comment">//       );</span>
<a name="l00161"></a>00161     
<a name="l00162"></a>00162   <span class="comment">//  /** Get the layer number of the specified module. </span>
<a name="l00163"></a>00163   <span class="comment">//   * @param group_index the first component of the index returned by @ref getIndex</span>
<a name="l00164"></a>00164   <span class="comment">//   * @param sub_group_index the second component of the index returned by @ref getIndex</span>
<a name="l00165"></a>00165   <span class="comment">//   * @return the layer number (0 ... Number of Calorimeter layers - 1 )</span>
<a name="l00166"></a>00166   <span class="comment">//   * @throw range_error if the module index is out of range and BOUNDARY_CHECK is defined</span>
<a name="l00167"></a>00167   <span class="comment">//   */</span>
<a name="l00168"></a>00168   <span class="comment">//  UInt_t getLayerIndex(UInt_t module_index,  UInt_t cell_index) const </span>
<a name="l00169"></a>00169   <span class="comment">//#ifdef BOUNDARY_CHECK</span>
<a name="l00170"></a>00170   <span class="comment">//    throw (range_error)</span>
<a name="l00171"></a>00171   <span class="comment">//#endif</span>
<a name="l00172"></a>00172   <span class="comment">//  {</span>
<a name="l00173"></a>00173   <span class="comment">//#ifdef BOUNDARY_CHECK</span>
<a name="l00174"></a>00174   <span class="comment">//    if (module_index&gt;=_moduleLocationList.size() || _moduleLocationList[module_index].second.getModuleType()&gt;=_moduleTypeList.size()) {</span>
<a name="l00175"></a>00175   <span class="comment">//    std::stringstream message;</span>
<a name="l00176"></a>00176   <span class="comment">//    message &lt;&lt; &quot;MappingAndAlignment::getLayerIndex&gt; Module &quot; &lt;&lt; module_index &lt;&lt; &quot;is not defined.&quot;;</span>
<a name="l00177"></a>00177   <span class="comment">//    throw range_error(message.str());</span>
<a name="l00178"></a>00178   <span class="comment">//    }</span>
<a name="l00179"></a>00179   <span class="comment">//#endif</span>
<a name="l00180"></a>00180   <span class="comment">//    return _moduleLocationList[module_index].second.getLayerNumber();</span>
<a name="l00181"></a>00181   <span class="comment">//  };</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00192"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4446637bff9619ec7750593d70ec46ba">00192</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4446637bff9619ec7750593d70ec46ba" title="Get the module and the cell index using the information of the electrical connection...">getModuleID</a>(UInt_t module_index) <span class="keyword">const</span>
<a name="l00193"></a>00193 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span>    <span class="keywordflow">throw</span> (range_error)
<a name="l00195"></a>00195 <span class="preprocessor">#endif</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>  {
<a name="l00197"></a>00197 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00198"></a>00198 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (module_index&gt;=_moduleLocationList.size() || _moduleLocationList[module_index].second.getModuleType() &gt;= _moduleTypeList.size()) {
<a name="l00199"></a>00199         std::stringstream message;
<a name="l00200"></a>00200         message &lt;&lt; <span class="stringliteral">&quot;MappingAndAlignment::getModuleID&gt; Module &quot;</span> &lt;&lt; module_index &lt;&lt; <span class="stringliteral">&quot;is not defined.&quot;</span>;
<a name="l00201"></a>00201         <span class="keywordflow">throw</span> range_error(message.str());
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 <span class="preprocessor">#endif</span>
<a name="l00204"></a>00204 <span class="preprocessor"></span>    <span class="keywordflow">return</span> _moduleLocationList[module_index].first;
<a name="l00205"></a>00205   }
<a name="l00206"></a>00206 
<a name="l00214"></a>00214   <span class="keywordtype">string</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a22517d7a1f82fe0326cf62784e67d4c7" title="Get the name containing the type specifier and the module ID.">getModuleName</a>(UInt_t module_index) <span class="keyword">const</span>
<a name="l00215"></a>00215 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00216"></a>00216 <span class="preprocessor"></span>    <span class="keywordflow">throw</span> (range_error,logic_error)
<a name="l00217"></a>00217 <span class="preprocessor">#else</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>    <span class="keywordflow">throw</span> (logic_error)
<a name="l00219"></a>00219 <span class="preprocessor">#endif</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span>    ;
<a name="l00221"></a>00221   
<a name="l00226"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#aba32017e2f902ec6cfdca96d9590dde4">00226</a>   <span class="keywordtype">bool</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#aba32017e2f902ec6cfdca96d9590dde4" title="Verify whether the module location is connected to an active front-end.">isModuleConnected</a>(UInt_t module_index) <span class="keyword">const</span>
<a name="l00227"></a>00227 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00228"></a>00228 <span class="preprocessor"></span>    <span class="keywordflow">throw</span> (range_error)
<a name="l00229"></a>00229 <span class="preprocessor">#endif</span>
<a name="l00230"></a>00230 <span class="preprocessor"></span>  {
<a name="l00231"></a>00231 <span class="preprocessor">#ifdef BOUNDARY_CHECK</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (module_index&gt;=_moduleLocationList.size()) {
<a name="l00233"></a>00233         std::stringstream message;
<a name="l00234"></a>00234         message &lt;&lt; <span class="stringliteral">&quot;MappingAndAlignment::isModuleConnected&gt; Module &quot;</span> &lt;&lt; module_index &lt;&lt; <span class="stringliteral">&quot;is not defined.&quot;</span>;
<a name="l00235"></a>00235         <span class="keywordflow">throw</span> range_error(message.str());
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 <span class="preprocessor">#endif</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span>    <span class="keywordflow">return</span> _moduleLocationList[module_index].first!=(UInt_t) -1;
<a name="l00239"></a>00239   };
<a name="l00240"></a>00240  
<a name="l00249"></a>00249   Int_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a7c80e28c748f3238cf2edca2a8190dc3" title="Return the module index for a given (*Mokka*) Cellindex All this assumes that the...">getModuleIndexFromCellIndex</a>(UInt_t);
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 
<a name="l00255"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a2ad32a5d8e7975eec6dc08d8e9062ee7">00255</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a2ad32a5d8e7975eec6dc08d8e9062ee7" title="Return the total number of defined cells.">getNCellsTotal</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a19b8f6a67746c23c116c97c467622079" title="total number of cells;">_nCells</a>;};
<a name="l00256"></a>00256 
<a name="l00259"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a46301567d4816d91e621600a33322cee">00259</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a46301567d4816d91e621600a33322cee" title="Return the number of cells connected to the DAQ.">getNConnectedCells</a>()<span class="keyword"> const </span>{<span class="keywordflow">return</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#aa1b0b2441f98af871ea184677e6a45e6" title="total number of cells which are connected to the DAQ;">_nConnectedCells</a>;};
<a name="l00260"></a>00260 
<a name="l00266"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a773b6a3deaa508092682424c757c6f21">00266</a>   Bool_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a773b6a3deaa508092682424c757c6f21" title="Verify whether the given cell is dead.">isCellDead</a>(UInt_t module_index, UInt_t cell_index) 
<a name="l00267"></a>00267     {
<a name="l00268"></a>00268       <span class="comment">// TODO: add conditions data  which contains the dead cells per module </span>
<a name="l00269"></a>00269       <span class="keywordflow">return</span> !<a class="code" href="classCALICE_1_1MappingAndAlignment.html#aba32017e2f902ec6cfdca96d9590dde4" title="Verify whether the module location is connected to an active front-end.">isModuleConnected</a>(module_index);
<a name="l00270"></a>00270     };
<a name="l00271"></a>00271 
<a name="l00277"></a>00277   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a5564c399de481a023b702a39a04fea7f" title="Inform the object about changes of the module types.">moduleTypeChanged</a>(lcio::LCCollection* col);
<a name="l00278"></a>00278 
<a name="l00284"></a>00284   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ab9d17873aeb090388556547cb6b67ba8" title="Inform the object about changes of the module locations.">moduleLocationChanged</a>(lcio::LCCollection* col);
<a name="l00285"></a>00285 
<a name="l00291"></a>00291   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a3717c2ea27a5a60ff2a41d17803ff148" title="Inform the object about changes of the module connection.">moduleConnectionChanged</a>(lcio::LCCollection* col);
<a name="l00292"></a>00292 
<a name="l00295"></a>00295   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a287c144d8b3df57eb3bea2d22b37e816" title="To debug.">print</a>(std::ostream &amp;os);
<a name="l00296"></a>00296   <span class="keywordtype">void</span> printTcmtConnections(std::ostream &amp;os);
<a name="l00297"></a>00297 
<a name="l00302"></a>00302   <span class="keywordtype">bool</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a01f7691dff98340b5a5b198109726b3c" title="Validates a crate number based on mapping.">isValidCrate</a>(UInt_t crate) <span class="keyword">const</span>;
<a name="l00303"></a>00303 
<a name="l00308"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a7f185408e77829624349e0e857a6eca3">00308</a>   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a7f185408e77829624349e0e857a6eca3" title="Toggle printing of the connecting tree after each rebuild (conditions data change:...">setViewConnectionTree</a>(<span class="keywordtype">bool</span> view_connection=<span class="keyword">true</span>) {_viewConnectionTree=view_connection;};
<a name="l00309"></a>00309 
<a name="l00315"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a35fd3d56055b90ee536669971ff4e842">00315</a>   <span class="keywordtype">bool</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a35fd3d56055b90ee536669971ff4e842" title="Return true if the front-end has a right side connected.">hasRightSide</a>(<span class="keyword">const</span> std::pair&lt;UInt_t,UInt_t&gt; &amp;module_indices)<span class="keyword"> const </span>{
<a name="l00316"></a>00316     <span class="keywordflow">return</span> module_indices.second&lt;UINT_MAX &amp;&amp; module_indices.second != module_indices.first;
<a name="l00317"></a>00317   };
<a name="l00318"></a>00318   
<a name="l00324"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a6a1819aca1589b9b289606c4628bdd0a">00324</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a6a1819aca1589b9b289606c4628bdd0a" title="Return the number above the last line which should be used for the left or the right...">getNumberOfLines</a>(<span class="keyword">const</span> std::pair&lt;UInt_t,UInt_t&gt; &amp;module_indices, <span class="keywordtype">bool</span> right_instead_of_left)<span class="keyword"> const </span>{
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (right_instead_of_left) {
<a name="l00326"></a>00326       <span class="keywordflow">return</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a251b86e88d0f7c13697e9bdce8a324f8" title="some constants">__nLines</a>;
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328     <span class="keywordflow">return</span> (module_indices.first == module_indices.second ? <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a251b86e88d0f7c13697e9bdce8a324f8" title="some constants">__nLines</a> : __nLinesHalf);
<a name="l00329"></a>00329   };
<a name="l00330"></a>00330 
<a name="l00333"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a5a476cb79ba69482760288820ded99e5">00333</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a5a476cb79ba69482760288820ded99e5" title="Return the first line associated to the module connected to the left side of the...">getLineIndexOfLeftSide</a>()<span class="keyword"> const </span>{
<a name="l00334"></a>00334     <span class="keywordflow">return</span> 0;
<a name="l00335"></a>00335   };
<a name="l00336"></a>00336 
<a name="l00339"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#ace30c8f6d801e2fc395516bc669e09c6">00339</a>   UInt_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ace30c8f6d801e2fc395516bc669e09c6" title="Return the first line associated to the module connected to the right side of the...">getLineIndexOfRightSide</a>()<span class="keyword"> const </span>{
<a name="l00340"></a>00340     <span class="keywordflow">return</span> __nLinesHalf;
<a name="l00341"></a>00341   };
<a name="l00342"></a>00342 
<a name="l00345"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a62f40cce6e79ea54a52983d8538f01c8">00345</a>   Bool_t <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a62f40cce6e79ea54a52983d8538f01c8" title="Basic completeness test of conditions data.">isModuleConditionsDataComplete</a>()<span class="keyword"> const </span>{
<a name="l00346"></a>00346     <span class="keywordflow">return</span> (( _moduleConnectionList.size()&gt;0 || _tcmtConnectionList.size()&gt;0 ) &amp;&amp;_moduleTypeList.size()&gt;0 &amp;&amp; _moduleLocationList.size()&gt;0);
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348 
<a name="l00349"></a>00349   UInt_t getMaxCellsPerFrontEnd()<span class="keyword"> const </span>{
<a name="l00350"></a>00350     <span class="keywordflow">return</span> _maxNCells;
<a name="l00351"></a>00351   }
<a name="l00352"></a>00352 
<a name="l00360"></a>00360   <span class="keyword">const</span> TcmtConnection* <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a0a65816e125db8d947ea0db2d9614a90" title="Get the connection object associated to an electronic channel.">getTcmtConnection</a>(UInt_t crate, UInt_t slot, UInt_t fe, UInt_t chip, UInt_t chan) <span class="keyword">const</span>;
<a name="l00361"></a>00361 
<a name="l00364"></a>00364   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a3979f678d52819accc77b415aaaf3aa1" title="Builds Ecal/Hcal connection mappings.">rebuildConnectionTree</a>();
<a name="l00365"></a>00365 
<a name="l00367"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4406a7799f33545f2911fe95ca320944">00367</a>   <span class="keyword">const</span> std::string <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4406a7799f33545f2911fe95ca320944" title="Returns the cell id encoding for the given detector.">getCellIDEncoding</a>(){<span class="keywordflow">return</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a28f0de5a05fe4d2e298836b63db2967a" title="A string which constains the cell id encoding.">_cellIDEncoding</a>;}  
<a name="l00368"></a>00368 
<a name="l00369"></a>00369 <span class="keyword">protected</span>:
<a name="l00372"></a>00372   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ad694ddef557f4fe05ae2419e87f22dda" title="Builds TCMT connection mappings.">rebuildTcmtConnectionTree</a>();
<a name="l00373"></a>00373 
<a name="l00375"></a>00375   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#ac0bfe9fec7fc2b8a6c0196e61429b558" title="Reset TCMT connection mappings.">clearTcmtConnections</a>();
<a name="l00376"></a>00376 
<a name="l00377"></a>00377 <span class="keyword">private</span>:
<a name="l00381"></a>00381   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a13ba7dc3c8e53ac73350fc5f81b3797f" title="Cludge to correct configuration errors.">correctFullHalfConnectorErrors</a>() ;
<a name="l00382"></a>00382   <span class="comment">//  typedef SimpleArray_t&lt;UInt_t&gt; ModuleIndexList_t; </span>
<a name="l00383"></a>00383   <span class="comment">//  ModuleList_t _moduleList;</span>
<a name="l00384"></a>00384 
<a name="l00391"></a>00391   <span class="keywordtype">void</span> <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a9f5684ddcdc43087817c2882e4e60760" title="Determine the maximum number of cells per front end.">determineMaximumCellNumberPerFrontEnd</a>();
<a name="l00392"></a>00392 
<a name="l00393"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4afbca274b2208db1f1fd688cd11cf06">00393</a>   <span class="keyword">typedef</span> <a class="code" href="classSimpleArray__t.html" title="Wrapper around std::vector which adds optional boundary check (at compile time).">SimpleArray_t&lt;UInt_t&gt;</a> <a class="code" href="classSimpleArray__t.html" title="Wrapper around std::vector which adds optional boundary check (at compile time).">FrontEndList_t</a>;                 
<a name="l00395"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a83157b1d568890919c1504e9f784d3c1">00395</a>   <span class="keyword">typedef</span> <a class="code" href="classSimpleArray__t.html" title="Wrapper around std::vector which adds optional boundary check (at compile time).">SimpleArray_t&lt;FrontEndList_t&gt;</a> <a class="code" href="classSimpleArray__t.html" title="Wrapper around std::vector which adds optional boundary check (at compile time).">SlotList_t</a>;             
<a name="l00397"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#ad781275a2200261d7900283ad388fce0">00397</a>   <span class="keyword">typedef</span> <a class="code" href="classSimpleArray__t.html" title="Wrapper around std::vector which adds optional boundary check (at compile time).">SimpleArray_t&lt;pair&lt;UInt_t,SlotList_t &gt;</a> &gt; <a class="code" href="classSimpleArray__t.html">CrateList_t</a>; 
<a name="l00399"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a11deca040a915bfa0b2bb41cde0c6bd0">00399</a>   <span class="keyword">typedef</span> <a class="code" href="classSimpleArray__t.html">SimpleArray_t&lt;ModuleConnection&gt;</a> <a class="code" href="classSimpleArray__t.html">ModuleConnectionList_t</a>; 
<a name="l00402"></a>00402   <a class="code" href="classSimpleArray__t.html">ModuleConnectionList_t</a> _moduleConnectionList;
<a name="l00403"></a>00403 
<a name="l00405"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4a2d15f2206d6729a7a913eb03934e1f">00405</a>   <span class="keyword">typedef</span> map&lt;int,TcmtConnection*&gt; <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4a2d15f2206d6729a7a913eb03934e1f" title="map of TCMT connections, keyed by elecID (slot,fe,chip,chan)">TcmtConnectionList_t</a>;
<a name="l00406"></a>00406   <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a4a2d15f2206d6729a7a913eb03934e1f" title="map of TCMT connections, keyed by elecID (slot,fe,chip,chan)">TcmtConnectionList_t</a> _tcmtConnectionList;
<a name="l00407"></a>00407 
<a name="l00408"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a248150849e7ee949b96327de20ab3d55">00408</a>   <span class="keyword">typedef</span> map&lt;UInt_t , UInt_t &gt; <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a248150849e7ee949b96327de20ab3d55" title="The first component is a uniqe module index (the index offset) , the second component...">ModuleIndex_t</a>; 
<a name="l00410"></a>00410   <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a248150849e7ee949b96327de20ab3d55" title="The first component is a uniqe module index (the index offset) , the second component...">ModuleIndex_t</a> _moduleIndex;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412 <span class="keyword">private</span>:
<a name="l00413"></a>00413   
<a name="l00414"></a>00414   <a class="code" href="classSimpleArray__t.html">CrateList_t</a> _crateList;
<a name="l00415"></a>00415 
<a name="l00416"></a>00416 <span class="keyword">private</span>:
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a19b8f6a67746c23c116c97c467622079">00418</a>   UInt_t  <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a19b8f6a67746c23c116c97c467622079" title="total number of cells;">_nCells</a>;                  
<a name="l00419"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#aa1b0b2441f98af871ea184677e6a45e6">00419</a>   UInt_t  <a class="code" href="classCALICE_1_1MappingAndAlignment.html#aa1b0b2441f98af871ea184677e6a45e6" title="total number of cells which are connected to the DAQ;">_nConnectedCells</a>;         
<a name="l00421"></a>00421   Bool_t _viewConnectionTree;
<a name="l00422"></a>00422 
<a name="l00424"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#adb2c356a3c031c3b76a2fa39b33452c3">00424</a>   <span class="keyword">typedef</span> std::map&lt;UInt_t, UInt_t&gt; <a class="code" href="classCALICE_1_1MappingAndAlignment.html#adb2c356a3c031c3b76a2fa39b33452c3" title="A map which relates indices (M,K) of a given cell to a module.">MapCelltoModuleIndex_t</a>;
<a name="l00425"></a>00425   <a class="code" href="classCALICE_1_1MappingAndAlignment.html#adb2c356a3c031c3b76a2fa39b33452c3" title="A map which relates indices (M,K) of a given cell to a module.">MapCelltoModuleIndex_t</a> _mapCelltoModuleIndex;
<a name="l00426"></a>00426 
<a name="l00429"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a28f0de5a05fe4d2e298836b63db2967a">00429</a>   std::string <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a28f0de5a05fe4d2e298836b63db2967a" title="A string which constains the cell id encoding.">_cellIDEncoding</a>;
<a name="l00430"></a>00430 
<a name="l00432"></a><a class="code" href="classCALICE_1_1MappingAndAlignment.html#a251b86e88d0f7c13697e9bdce8a324f8">00432</a>   <span class="keyword">static</span> <span class="keyword">const</span> UInt_t  <a class="code" href="classCALICE_1_1MappingAndAlignment.html#a251b86e88d0f7c13697e9bdce8a324f8" title="some constants">__nLines</a>    ;
<a name="l00433"></a>00433   <span class="keyword">static</span> <span class="keyword">const</span> UInt_t  __nLinesHalf;
<a name="l00434"></a>00434   <span class="keyword">static</span> <span class="keyword">const</span> UInt_t  __nFrontEnds;
<a name="l00435"></a>00435   UInt_t _maxNCells;
<a name="l00436"></a>00436 };
<a name="l00437"></a>00437 }
<a name="l00438"></a>00438 <span class="preprocessor">#endif</span>
<a name="l00439"></a>00439 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 1 Dec 2017 for CALICE_USERLIB by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
